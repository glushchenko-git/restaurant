<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ресторан "Deluxe" - Система управления</title>
    <style>
        :root {
            --primary-color: #8B4513;
            --secondary-color: #D2691E;
            --accent-color: #FFD700;
            --light-color: #F5F5DC;
            --dark-color: #3E2723;
            --success-color: #4CAF50;
            --danger-color: #f44336;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f9f9f9;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: var(--shadow);
            border-radius: 0 0 10px 10px;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 24px;
            background-color: var(--light-color);
            border: none;
            border-radius: 5px 5px 0 0;
            margin: 0 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .tab:hover {
            background-color: var(--accent-color);
        }
        
        .tab.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .content-section {
            display: none;
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }
        
        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-title {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-color);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s ease;
        }
        
        button:hover {
            background-color: var(--secondary-color);
        }
        
        .btn-success {
            background-color: var(--success-color);
        }
        
        .btn-danger {
            background-color: var(--danger-color);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary-color);
        }
        
        .card h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .card p {
            margin-bottom: 8px;
        }
        
        .card-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .status-open {
            background-color: #e7f3ff;
            color: #0066cc;
        }
        
        .status-closed {
            background-color: #e6f4ea;
            color: var(--success-color);
        }
        
        .status-reserved {
            background-color: #fff8e1;
            color: #ff9800;
        }
        
        .receipt {
            background-color: #f9f9f9;
            border: 1px dashed #ccc;
            padding: 20px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
        }
        
        .receipt-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .receipt-total {
            border-top: 1px solid #000;
            padding-top: 10px;
            font-weight: bold;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .menu-category {
            margin-bottom: 30px;
        }
        
        .dish-checkbox {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .dish-checkbox input {
            width: auto;
            margin-right: 10px;
        }
        
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                margin-bottom: 5px;
                border-radius: 5px;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Ресторан "Deluxe"</h1>
            <p class="subtitle">Система управления бронированием и заказами</p>
        </div>
    </header>
    
    <div class="container">
        <div class="tabs">
            <button class="tab active" data-tab="reservations">Бронирование</button>
            <button class="tab" data-tab="orders">Заказы</button>
            <button class="tab" data-tab="dishes">Меню</button>
            <button class="tab" data-tab="statistics">Статистика</button>
        </div>
        
        <!-- Секция бронирования -->
        <section id="reservations" class="content-section active">
            <h2 class="section-title">Управление бронированием</h2>
            
            <div class="form-group">
                <h3>Добавить новый стол</h3>
                <form id="add-table-form">
                    <div class="form-group">
                        <label for="table-id">ID стола:</label>
                        <input type="number" id="table-id" required>
                    </div>
                    <div class="form-group">
                        <label for="table-location">Расположение:</label>
                        <select id="table-location" required>
                            <option value="у окна">У окна</option>
                            <option value="у прохода">У прохода</option>
                            <option value="у выхода">У выхода</option>
                            <option value="в глубине">В глубине</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="table-seats">Количество мест:</label>
                        <input type="number" id="table-seats" required min="1">
                    </div>
                    <button type="submit">Добавить стол</button>
                </form>
            </div>
            
            <div class="form-group">
                <h3>Создать бронирование</h3>
                <form id="add-reservation-form">
                    <div class="form-group">
                        <label for="reservation-client">Имя клиента:</label>
                        <input type="text" id="reservation-client" required>
                    </div>
                    <div class="form-group">
                        <label for="reservation-phone">Телефон:</label>
                        <input type="tel" id="reservation-phone" required>
                    </div>
                    <div class="form-group">
                        <label for="reservation-table">Выберите стол:</label>
                        <select id="reservation-table" required>
                            <!-- Столы будут добавлены через JS -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reservation-date">Дата:</label>
                        <input type="date" id="reservation-date" required>
                    </div>
                    <div class="form-group">
                        <label for="reservation-time">Время:</label>
                        <select id="reservation-time" required>
                            <option value="9">9:00</option>
                            <option value="10">10:00</option>
                            <option value="11">11:00</option>
                            <option value="12">12:00</option>
                            <option value="13">13:00</option>
                            <option value="14">14:00</option>
                            <option value="15">15:00</option>
                            <option value="16">16:00</option>
                            <option value="17">17:00</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reservation-duration">Продолжительность (часы):</label>
                        <input type="number" id="reservation-duration" min="1" max="4" value="2" required>
                    </div>
                    <div class="form-group">
                        <label for="reservation-comment">Комментарий:</label>
                        <textarea id="reservation-comment" rows="3"></textarea>
                    </div>
                    <button type="submit">Забронировать</button>
                </form>
            </div>
            
            <h3 class="section-title">Список столов</h3>
            <div id="tables-list" class="grid">
                <!-- Столы будут добавлены через JS -->
            </div>
            
            <h3 class="section-title">Активные бронирования</h3>
            <div id="reservations-list" class="grid">
                <!-- Бронирования будут добавлены через JS -->
            </div>
        </section>
        
        <!-- Секция заказов -->
        <section id="orders" class="content-section">
            <h2 class="section-title">Управление заказами</h2>
            
            <div class="form-group">
                <h3>Создать заказ</h3>
                <form id="add-order-form">
                    <div class="form-group">
                        <label for="order-table">Стол:</label>
                        <select id="order-table" required>
                            <!-- Столы будут добавлены через JS -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="order-waiter">Официант:</label>
                        <select id="order-waiter" required>
                            <option value="1">Иван Петров</option>
                            <option value="2">Мария Сидорова</option>
                            <option value="3">Алексей Козлов</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="order-dishes">Выберите блюда:</label>
                        <div id="dishes-selection">
                            <!-- Блюда будут добавлены через JS -->
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="order-comment">Комментарий к заказу:</label>
                        <textarea id="order-comment" rows="3"></textarea>
                    </div>
                    <button type="submit">Создать заказ</button>
                </form>
            </div>
            
            <h3 class="section-title">Активные заказы</h3>
            <div id="orders-list" class="grid">
                <!-- Заказы будут добавлены через JS -->
            </div>
        </section>
        
        <!-- Секция меню -->
        <section id="dishes" class="content-section">
            <h2 class="section-title">Управление меню</h2>
            
            <div class="form-group">
                <h3>Добавить блюдо</h3>
                <form id="add-dish-form">
                    <div class="form-group">
                        <label for="dish-name">Название блюда:</label>
                        <input type="text" id="dish-name" required>
                    </div>
                    <div class="form-group">
                        <label for="dish-category">Категория:</label>
                        <select id="dish-category" required>
                            <option value="Напитки">Напитки</option>
                            <option value="Салаты">Салаты</option>
                            <option value="Холодные закуски">Холодные закуски</option>
                            <option value="Горячие закуски">Горячие закуски</option>
                            <option value="Супы">Супы</option>
                            <option value="Горячие блюда">Горячие блюда</option>
                            <option value="Десерты">Десерты</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="dish-composition">Состав:</label>
                        <textarea id="dish-composition" rows="2" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="dish-weight">Вес (г/мл):</label>
                        <input type="text" id="dish-weight" required>
                    </div>
                    <div class="form-group">
                        <label for="dish-price">Цена (руб.):</label>
                        <input type="number" id="dish-price" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="dish-cooking-time">Время готовки (мин.):</label>
                        <input type="number" id="dish-cooking-time" min="1" required>
                    </div>
                    <div class="form-group">
                        <label for="dish-tags">Теги (через запятую):</label>
                        <input type="text" id="dish-tags" placeholder="острое, веганское, халяль">
                    </div>
                    <button type="submit">Добавить блюдо</button>
                </form>
            </div>
            
            <h3 class="section-title">Меню ресторана</h3>
            <div id="menu-list">
                <!-- Меню будет добавлено через JS -->
            </div>
        </section>
        
        <!-- Секция статистики -->
        <section id="statistics" class="content-section">
            <h2 class="section-title">Статистика ресторана</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Всего заказов</div>
                    <div class="stat-value" id="total-orders">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Общая выручка</div>
                    <div class="stat-value" id="total-revenue">0 руб.</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Активных бронирований</div>
                    <div class="stat-value" id="active-reservations">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Блюд в меню</div>
                    <div class="stat-value" id="total-dishes">0</div>
                </div>
            </div>
            
            <h3 class="section-title">Статистика по официантам</h3>
            <div id="waiters-stats" class="grid">
                <!-- Статистика официантов будет добавлена через JS -->
            </div>
            
            <h3 class="section-title">Популярные блюда</h3>
            <div id="popular-dishes" class="grid">
                <!-- Популярные блюда будут добавлены через JS -->
            </div>
        </section>
    </div>

    <script>
        // Классы из файлов задания
        
        // Класс Table (из первого задания)
        class Table {
            constructor(id, location, seats) {
                this.id = id;
                this.location = location;
                this.seats = seats;
                this.schedule = {};
            }
            
            updateInfo(location, seats) {
                this.location = location;
                this.seats = seats;
            }
            
            printInfo() {
                let info = `ID: ${this.id}\n`;
                info += `Расположение: ${this.location}\n`;
                info += `Количество мест: ${this.seats}\n`;
                info += "Расписание:\n";
                
                for (let hour = 9; hour < 18; hour++) {
                    const time = new Date();
                    time.setHours(hour, 0, 0, 0);
                    const endTime = new Date(time.getTime() + 60 * 60 * 1000);
                    
                    if (this.schedule[time.toISOString()]) {
                        const res = this.schedule[time.toISOString()];
                        info += `${time.getHours()}:00-${endTime.getHours()}:00 --- ID ${res.id}, ${res.clientName}, ${res.phone}\n`;
                    } else {
                        info += `${time.getHours()}:00-${endTime.getHours()}:00 ---\n`;
                    }
                }
                
                return info;
            }
        }
        
        // Класс Reservation (из первого задания)
        class Reservation {
            constructor(id, clientName, phone, startTime, endTime, comment, table) {
                this.id = id;
                this.clientName = clientName;
                this.phone = phone;
                this.startTime = startTime;
                this.endTime = endTime;
                this.comment = comment;
                this.assignedTable = table;
                
                // Заполняем расписание стола
                for (let time = new Date(startTime); time < endTime; time.setHours(time.getHours() + 1)) {
                    table.schedule[time.toISOString()] = this;
                }
            }
            
            updateReservation(newStart, newEnd, newTable) {
                // Освобождаем старые слоты
                for (let time = new Date(this.startTime); time < this.endTime; time.setHours(time.getHours() + 1)) {
                    delete this.assignedTable.schedule[time.toISOString()];
                }
                
                this.startTime = newStart;
                this.endTime = newEnd;
                this.assignedTable = newTable;
                
                // Занимаем новые слоты
                for (let time = new Date(newStart); time < newEnd; time.setHours(time.getHours() + 1)) {
                    newTable.schedule[time.toISOString()] = this;
                }
            }
            
            cancelReservation() {
                for (let time = new Date(this.startTime); time < this.endTime; time.setHours(time.getHours() + 1)) {
                    delete this.assignedTable.schedule[time.toISOString()];
                }
            }
        }
        
        // Класс Dish (из второго задания)
        class Dish {
            constructor(id, name, composition, weight, price, category, cookingTime, tags = []) {
                this.id = id;
                this.name = name;
                this.composition = composition;
                this.weight = weight;
                this.price = price;
                this.category = category;
                this.cookingTime = cookingTime;
                this.tags = Array.isArray(tags) ? tags : [tags];
            }
            
            updateDish(name, composition, weight, price, category, cookingTime, tags = []) {
                this.name = name;
                this.composition = composition;
                this.weight = weight;
                this.price = price;
                this.category = category;
                this.cookingTime = cookingTime;
                this.tags = Array.isArray(tags) ? tags : [tags];
            }
            
            printInfo() {
                let info = `ID: ${this.id}\n`;
                info += `Название: ${this.name}\n`;
                info += `Состав: ${this.composition}\n`;
                info += `Вес: ${this.weight}\n`;
                info += `Цена: ${this.price} руб.\n`;
                info += `Категория: ${this.category}\n`;
                info += `Время готовки: ${this.cookingTime} мин.\n`;
                info += `Теги: ${this.tags.join(', ')}\n`;
                
                return info;
            }
        }
        
        // Класс Order (из второго задания)
        class Order {
            constructor(id, tableId, comment, waiterId, dishes = []) {
                this.id = id;
                this.tableId = tableId;
                this.comment = comment;
                this.waiterId = waiterId;
                this.orderTime = new Date();
                this.dishes = Array.isArray(dishes) ? dishes : [dishes];
                this.closeTime = null;
                this.calculateTotalPrice();
            }
            
            updateOrder(tableId, comment, waiterId, dishes = []) {
                this.tableId = tableId;
                this.comment = comment;
                this.waiterId = waiterId;
                this.dishes = Array.isArray(dishes) ? dishes : [dishes];
                this.calculateTotalPrice();
            }
            
            calculateTotalPrice() {
                this.totalPrice = this.dishes.reduce((sum, dish) => sum + dish.price, 0);
            }
            
            printInfo() {
                let info = `ID заказа: ${this.id}\n`;
                info += `Столик: ${this.tableId}\n`;
                info += `Официант: ${this.waiterId}\n`;
                info += `Время заказа: ${this.orderTime.toLocaleString()}\n`;
                info += `Комментарий: ${this.comment}\n`;
                info += "Блюда:\n";
                
                this.dishes.forEach(dish => {
                    info += `  - ${dish.name} (${dish.price} руб.)\n`;
                });
                
                info += `Итого: ${this.totalPrice} руб.\n`;
                info += `Статус: ${this.closeTime ? 'Закрыт' : 'Открыт'}\n`;
                
                return info;
            }
            
            closeOrder() {
                this.closeTime = new Date();
            }
            
            printReceipt(allDishes) {
                if (!this.closeTime) {
                    return "Чек можно распечатать только для закрытых заказов!";
                }
                
                let receipt = "***********************\n";
                receipt += `Столик: ${this.tableId}\n`;
                receipt += `Официант: ${this.waiterId}\n`;
                receipt += `Период обслуживания: с ${this.orderTime.toLocaleString()} по ${this.closeTime.toLocaleString()}\n\n`;
                
                // Группируем блюда по категориям
                const dishesByCategory = {};
                this.dishes.forEach(dish => {
                    if (!dishesByCategory[dish.category]) {
                        dishesByCategory[dish.category] = [];
                    }
                    dishesByCategory[dish.category].push(dish);
                });
                
                let total = 0;
                
                for (const category in dishesByCategory) {
                    receipt += `${category}:\n`;
                    
                    const dishCounts = {};
                    dishesByCategory[category].forEach(dish => {
                        dishCounts[dish.id] = dishCounts[dish.id] ? dishCounts[dish.id] + 1 : 1;
                    });
                    
                    let categorySubtotal = 0;
                    
                    for (const dishId in dishCounts) {
                        const dish = allDishes.find(d => d.id == dishId);
                        if (dish) {
                            const dishTotal = dish.price * dishCounts[dishId];
                            receipt += `  ${dish.name}    ${dishCounts[dishId]}*${dish.price}=${dishTotal} руб.\n`;
                            categorySubtotal += dishTotal;
                        }
                    }
                    
                    receipt += `Под-итог категории: ${categorySubtotal} руб.\n\n`;
                    total += categorySubtotal;
                }
                
                receipt += `Итог счета: ${total} руб.\n`;
                receipt += "***********************";
                
                return receipt;
            }
        }
        
        // Данные приложения
        let tables = [
            new Table(1, "у окна", 4),
            new Table(2, "у прохода", 2),
            new Table(3, "в глубине", 6)
        ];
        
        let reservations = [];
        
        let dishes = [
            new Dish(1, "Цезарь", "Салат, курица, сыр", "250/50/30", 450, "Салаты", 10, ["классика"]),
            new Dish(2, "Борщ", "Свекла, мясо, сметана", "300/50", 350, "Супы", 25, ["традиционный"]),
            new Dish(3, "Стейк", "Говядина, специи", "200/50", 890, "Горячие блюда", 20, ["мясо", "премиум"]),
            new Dish(4, "Кофе", "Арабика", "200", 180, "Напитки", 5, ["горячий"])
        ];
        
        let orders = [];
        
        let waiters = [
            { id: 1, name: "Иван Петров" },
            { id: 2, name: "Мария Сидорова" },
            { id: 3, name: "Алексей Козлов" }
        ];
        
        // Инициализация приложения
        document.addEventListener('DOMContentLoaded', function() {
            // Инициализация вкладок
            initTabs();
            
            // Загрузка данных
            renderTables();
            renderReservations();
            renderDishes();
            renderOrders();
            renderMenu();
            updateStatistics();
            
            // Обработчики форм
            document.getElementById('add-table-form').addEventListener('submit', addTable);
            document.getElementById('add-reservation-form').addEventListener('submit', addReservation);
            document.getElementById('add-dish-form').addEventListener('submit', addDish);
            document.getElementById('add-order-form').addEventListener('submit', addOrder);
        });
        
        // Инициализация вкладок
        function initTabs() {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Убираем активный класс у всех вкладок
                    tabs.forEach(t => t.classList.remove('active'));
                    // Добавляем активный класс текущей вкладке
                    this.classList.add('active');
                    
                    // Скрываем все секции
                    const sections = document.querySelectorAll('.content-section');
                    sections.forEach(section => section.classList.remove('active'));
                    
                    // Показываем нужную секцию
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });
        }
        
        // Рендер столов
        function renderTables() {
            const tablesList = document.getElementById('tables-list');
            const reservationTableSelect = document.getElementById('reservation-table');
            const orderTableSelect = document.getElementById('order-table');
            
            // Очищаем списки
            tablesList.innerHTML = '';
            reservationTableSelect.innerHTML = '';
            orderTableSelect.innerHTML = '';
            
            tables.forEach(table => {
                // Добавляем в список столов
                const tableCard = document.createElement('div');
                tableCard.className = 'card';
                tableCard.innerHTML = `
                    <h3>Стол #${table.id}</h3>
                    <p><strong>Расположение:</strong> ${table.location}</p>
                    <p><strong>Мест:</strong> ${table.seats}</p>
                    <div class="card-actions">
                        <button class="btn-danger" onclick="deleteTable(${table.id})">Удалить</button>
                    </div>
                `;
                tablesList.appendChild(tableCard);
                
                // Добавляем в выпадающие списки
                const option = document.createElement('option');
                option.value = table.id;
                option.textContent = `Стол #${table.id} (${table.location}, ${table.seats} мест)`;
                reservationTableSelect.appendChild(option.cloneNode(true));
                orderTableSelect.appendChild(option);
            });
        }
        
        // Рендер бронирований
        function renderReservations() {
            const reservationsList = document.getElementById('reservations-list');
            reservationsList.innerHTML = '';
            
            reservations.forEach(reservation => {
                const table = tables.find(t => t.id === reservation.assignedTable.id);
                const reservationCard = document.createElement('div');
                reservationCard.className = 'card';
                reservationCard.innerHTML = `
                    <h3>Бронирование #${reservation.id}</h3>
                    <p><strong>Клиент:</strong> ${reservation.clientName}</p>
                    <p><strong>Телефон:</strong> ${reservation.phone}</p>
                    <p><strong>Стол:</strong> #${reservation.assignedTable.id} (${table.location})</p>
                    <p><strong>Время:</strong> ${reservation.startTime.toLocaleString()}</p>
                    <p><strong>Продолжительность:</strong> ${Math.round((reservation.endTime - reservation.startTime) / (60 * 60 * 1000))} ч.</p>
                    <p><strong>Комментарий:</strong> ${reservation.comment}</p>
                    <div class="card-actions">
                        <button class="btn-danger" onclick="cancelReservation(${reservation.id})">Отменить</button>
                    </div>
                `;
                reservationsList.appendChild(reservationCard);
            });
        }
        
        // Рендер блюд для выбора в заказе
        function renderDishes() {
            const dishesSelection = document.getElementById('dishes-selection');
            dishesSelection.innerHTML = '';
            
            // Группируем блюда по категориям
            const dishesByCategory = {};
            dishes.forEach(dish => {
                if (!dishesByCategory[dish.category]) {
                    dishesByCategory[dish.category] = [];
                }
                dishesByCategory[dish.category].push(dish);
            });
            
            // Создаем чекбоксы для каждого блюда
            for (const category in dishesByCategory) {
                const categoryTitle = document.createElement('h4');
                categoryTitle.textContent = category;
                categoryTitle.style.marginTop = '15px';
                categoryTitle.style.color = 'var(--primary-color)';
                dishesSelection.appendChild(categoryTitle);
                
                dishesByCategory[category].forEach(dish => {
                    const dishCheckbox = document.createElement('div');
                    dishCheckbox.className = 'dish-checkbox';
                    dishCheckbox.innerHTML = `
                        <input type="checkbox" id="dish-${dish.id}" value="${dish.id}">
                        <label for="dish-${dish.id}">${dish.name} - ${dish.price} руб.</label>
                    `;
                    dishesSelection.appendChild(dishCheckbox);
                });
            }
        }
        
        // Рендер заказов
        function renderOrders() {
            const ordersList = document.getElementById('orders-list');
            ordersList.innerHTML = '';
            
            orders.forEach(order => {
                const table = tables.find(t => t.id === order.tableId);
                const waiter = waiters.find(w => w.id === order.waiterId);
                const orderDishes = order.dishes.map(dish => dish.name).join(', ');
                
                const orderCard = document.createElement('div');
                orderCard.className = 'card';
                orderCard.innerHTML = `
                    <h3>Заказ #${order.id}</h3>
                    <p><strong>Стол:</strong> #${order.tableId} (${table.location})</p>
                    <p><strong>Официант:</strong> ${waiter.name}</p>
                    <p><strong>Блюда:</strong> ${orderDishes}</p>
                    <p><strong>Комментарий:</strong> ${order.comment}</p>
                    <p><strong>Сумма:</strong> ${order.totalPrice} руб.</p>
                    <p><strong>Статус:</strong> 
                        <span class="status-badge ${order.closeTime ? 'status-closed' : 'status-open'}">
                            ${order.closeTime ? 'Закрыт' : 'Открыт'}
                        </span>
                    </p>
                    <div class="card-actions">
                        ${!order.closeTime ? `<button onclick="closeOrder(${order.id})">Закрыть заказ</button>` : ''}
                        <button class="btn-danger" onclick="deleteOrder(${order.id})">Удалить</button>
                        ${order.closeTime ? `<button onclick="showReceipt(${order.id})">Показать чек</button>` : ''}
                    </div>
                `;
                ordersList.appendChild(orderCard);
            });
        }
        
        // Рендер меню
        function renderMenu() {
            const menuList = document.getElementById('menu-list');
            menuList.innerHTML = '';
            
            // Группируем блюда по категориям
            const dishesByCategory = {};
            dishes.forEach(dish => {
                if (!dishesByCategory[dish.category]) {
                    dishesByCategory[dish.category] = [];
                }
                dishesByCategory[dish.category].push(dish);
            });
            
            // Создаем карточки для каждой категории
            for (const category in dishesByCategory) {
                const categorySection = document.createElement('div');
                categorySection.className = 'menu-category';
                categorySection.innerHTML = `<h3 class="section-title">${category}</h3>`;
                
                const categoryGrid = document.createElement('div');
                categoryGrid.className = 'grid';
                
                dishesByCategory[category].forEach(dish => {
                    const dishCard = document.createElement('div');
                    dishCard.className = 'card';
                    dishCard.innerHTML = `
                        <h3>${dish.name}</h3>
                        <p><strong>Состав:</strong> ${dish.composition}</p>
                        <p><strong>Вес:</strong> ${dish.weight}</p>
                        <p><strong>Цена:</strong> ${dish.price} руб.</p>
                        <p><strong>Время готовки:</strong> ${dish.cookingTime} мин.</p>
                        <p><strong>Теги:</strong> ${dish.tags.join(', ')}</p>
                        <div class="card-actions">
                            <button class="btn-danger" onclick="deleteDish(${dish.id})">Удалить</button>
                        </div>
                    `;
                    categoryGrid.appendChild(dishCard);
                });
                
                categorySection.appendChild(categoryGrid);
                menuList.appendChild(categorySection);
            }
        }
        
        // Обновление статистики
        function updateStatistics() {
            // Общая статистика
            document.getElementById('total-orders').textContent = orders.length;
            document.getElementById('total-revenue').textContent = 
                orders.filter(o => o.closeTime).reduce((sum, order) => sum + order.totalPrice, 0) + ' руб.';
            document.getElementById('active-reservations').textContent = reservations.length;
            document.getElementById('total-dishes').textContent = dishes.length;
            
            // Статистика по официантам
            const waitersStats = document.getElementById('waiters-stats');
            waitersStats.innerHTML = '';
            
            waiters.forEach(waiter => {
                const waiterOrders = orders.filter(o => o.waiterId === waiter.id);
                const closedOrders = waiterOrders.filter(o => o.closeTime);
                const totalRevenue = closedOrders.reduce((sum, order) => sum + order.totalPrice, 0);
                
                const waiterCard = document.createElement('div');
                waiterCard.className = 'card';
                waiterCard.innerHTML = `
                    <h3>${waiter.name}</h3>
                    <p><strong>Количество заказов:</strong> ${waiterOrders.length}</p>
                    <p><strong>Закрытых заказов:</strong> ${closedOrders.length}</p>
                    <p><strong>Общая выручка:</strong> ${totalRevenue} руб.</p>
                    <p><strong>Средний чек:</strong> ${closedOrders.length > 0 ? Math.round(totalRevenue / closedOrders.length) : 0} руб.</p>
                `;
                waitersStats.appendChild(waiterCard);
            });
            
            // Популярные блюда
            const popularDishes = document.getElementById('popular-dishes');
            popularDishes.innerHTML = '';
            
            // Считаем количество заказов для каждого блюда
            const dishStats = {};
            orders.forEach(order => {
                order.dishes.forEach(dish => {
                    dishStats[dish.id] = dishStats[dish.id] ? dishStats[dish.id] + 1 : 1;
                });
            });
            
            // Сортируем блюда по популярности
            const sortedDishes = [...dishes].sort((a, b) => (dishStats[b.id] || 0) - (dishStats[a.id] || 0));
            
            sortedDishes.slice(0, 4).forEach(dish => {
                const dishCard = document.createElement('div');
                dishCard.className = 'card';
                dishCard.innerHTML = `
                    <h3>${dish.name}</h3>
                    <p><strong>Категория:</strong> ${dish.category}</p>
                    <p><strong>Цена:</strong> ${dish.price} руб.</p>
                    <p><strong>Заказов:</strong> ${dishStats[dish.id] || 0}</p>
                `;
                popularDishes.appendChild(dishCard);
            });
        }
        
        // Функции для работы с данными
        
        function addTable(e) {
            e.preventDefault();
            const id = parseInt(document.getElementById('table-id').value);
            const location = document.getElementById('table-location').value;
            const seats = parseInt(document.getElementById('table-seats').value);
            
            // Проверяем, существует ли уже стол с таким ID
            if (tables.some(table => table.id === id)) {
                alert('Стол с таким ID уже существует!');
                return;
            }
            
            tables.push(new Table(id, location, seats));
            renderTables();
            document.getElementById('add-table-form').reset();
            alert('Стол успешно добавлен!');
        }
        
        function deleteTable(id) {
            if (confirm('Вы уверены, что хотите удалить этот стол?')) {
                tables = tables.filter(table => table.id !== id);
                renderTables();
            }
        }
        
        function addReservation(e) {
            e.preventDefault();
            const clientName = document.getElementById('reservation-client').value;
            const phone = document.getElementById('reservation-phone').value;
            const tableId = parseInt(document.getElementById('reservation-table').value);
            const date = document.getElementById('reservation-date').value;
            const time = parseInt(document.getElementById('reservation-time').value);
            const duration = parseInt(document.getElementById('reservation-duration').value);
            const comment = document.getElementById('reservation-comment').value;
            
            const table = tables.find(t => t.id === tableId);
            if (!table) {
                alert('Выбранный стол не найден!');
                return;
            }
            
            const startTime = new Date(date);
            startTime.setHours(time, 0, 0, 0);
            
            const endTime = new Date(startTime.getTime() + duration * 60 * 60 * 1000);
            
            const id = reservations.length > 0 ? Math.max(...reservations.map(r => r.id)) + 1 : 1;
            
            reservations.push(new Reservation(
                id, clientName, phone, startTime, endTime, comment, table
            ));
            
            renderReservations();
            document.getElementById('add-reservation-form').reset();
            alert('Бронирование успешно создано!');
        }
        
        function cancelReservation(id) {
            if (confirm('Вы уверены, что хотите отменить это бронирование?')) {
                const reservation = reservations.find(r => r.id === id);
                if (reservation) {
                    reservation.cancelReservation();
                }
                reservations = reservations.filter(reservation => reservation.id !== id);
                renderReservations();
            }
        }
        
        function addDish(e) {
            e.preventDefault();
            const name = document.getElementById('dish-name').value;
            const category = document.getElementById('dish-category').value;
            const composition = document.getElementById('dish-composition').value;
            const weight = document.getElementById('dish-weight').value;
            const price = parseFloat(document.getElementById('dish-price').value);
            const cookingTime = parseInt(document.getElementById('dish-cooking-time').value);
            const tags = document.getElementById('dish-tags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
            
            const id = dishes.length > 0 ? Math.max(...dishes.map(d => d.id)) + 1 : 1;
            
            dishes.push(new Dish(
                id, name, composition, weight, price, category, cookingTime, tags
            ));
            
            renderDishes();
            renderMenu();
            document.getElementById('add-dish-form').reset();
            updateStatistics();
            alert('Блюдо успешно добавлено в меню!');
        }
        
        function deleteDish(id) {
            if (confirm('Вы уверены, что хотите удалить это блюдо из меню?')) {
                dishes = dishes.filter(dish => dish.id !== id);
                renderDishes();
                renderMenu();
                updateStatistics();
            }
        }
        
        function addOrder(e) {
            e.preventDefault();
            const tableId = parseInt(document.getElementById('order-table').value);
            const waiterId = parseInt(document.getElementById('order-waiter').value);
            const comment = document.getElementById('order-comment').value;
            
            // Получаем выбранные блюда
            const selectedDishIds = [];
            const checkboxes = document.querySelectorAll('#dishes-selection input[type="checkbox"]:checked');
            checkboxes.forEach(checkbox => {
                selectedDishIds.push(parseInt(checkbox.value));
            });
            
            if (selectedDishIds.length === 0) {
                alert('Выберите хотя бы одно блюдо для заказа!');
                return;
            }
            
            // Находим объекты блюд по ID
            const selectedDishes = selectedDishIds.map(id => dishes.find(d => d.id === id));
            
            const id = orders.length > 0 ? Math.max(...orders.map(o => o.id)) + 1 : 1;
            
            orders.push(new Order(
                id, tableId, comment, waiterId, selectedDishes
            ));
            
            renderOrders();
            document.getElementById('add-order-form').reset();
            updateStatistics();
            alert('Заказ успешно создан!');
        }
        
        function closeOrder(id) {
            const order = orders.find(o => o.id === id);
            if (order) {
                order.closeOrder();
                renderOrders();
                updateStatistics();
                alert('Заказ закрыт!');
            }
        }
        
        function deleteOrder(id) {
            if (confirm('Вы уверены, что хотите удалить этот заказ?')) {
                orders = orders.filter(order => order.id !== id);
                renderOrders();
                updateStatistics();
            }
        }
        
        function showReceipt(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                const receipt = order.printReceipt(dishes);
                alert(receipt);
            }
        }
        
        // Глобальные функции для вызова из HTML
        window.deleteTable = deleteTable;
        window.cancelReservation = cancelReservation;
        window.deleteDish = deleteDish;
        window.closeOrder = closeOrder;
        window.deleteOrder = deleteOrder;
        window.showReceipt = showReceipt;
    </script>
</body>
</html>